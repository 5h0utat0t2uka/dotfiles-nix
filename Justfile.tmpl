set dotenv-load := false
set shell := ["bash", "-euo", "pipefail", "-c"]

flake := "{{ .chezmoi.sourceDir }}/nix"
hostname := `scutil --get LocalHostName 2>/dev/null`

check:
  nix flake check {{ "{{flake}}" }}

build:
  sudo darwin-rebuild switch --flake {{ "{{flake}}" }}#{{ "{{hostname}}" }}

only-update:
  cd {{ "{{flake}}" }} && nix flake update

full-update:
  cd {{ "{{flake}}" }} && nix flake update
  sudo darwin-rebuild switch --flake {{ "{{flake}}" }}#{{ "{{hostname}}" }}

gc:
  nix-collect-garbage -d
