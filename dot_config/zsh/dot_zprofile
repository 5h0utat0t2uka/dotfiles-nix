typeset -U path
path=(
  "$HOME/.local/bin"
  "/etc/profiles/per-user/$USER/bin"
  "/run/current-system/sw/bin"
  $path
)

if [[ -d /opt/homebrew/bin ]]; then
  path+=("/opt/homebrew/bin" "/opt/homebrew/sbin")
fi

# Homebrew (prefer nix-homebrew unified launcher; fallback to default prefix)
# if [[ -x /run/current-system/sw/bin/brew ]]; then
#   eval "$(/run/current-system/sw/bin/brew shellenv)"
# elif [[ -x /opt/homebrew/bin/brew ]]; then
#   eval "$(/opt/homebrew/bin/brew shellenv)"
# fi

# Choose profile prefix by checking where plugin layout actually exists.
if [[ -d "/etc/profiles/per-user/$USER/share/zsh/plugins" ]]; then
  export NIX_PROFILE_PREFIX="/etc/profiles/per-user/$USER"
elif [[ -d "$HOME/.nix-profile/share/zsh/plugins" ]]; then
  export NIX_PROFILE_PREFIX="$HOME/.nix-profile"
else
  unset NIX_PROFILE_PREFIX
fi
